<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Icons & Fonts -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- Main stylesheet -->

  <link rel="icon" type="image/png" href="{{url_for('static', filename='./images/deped_seal.png')}}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='./css/admin_dashboard.css') }}" />
</head>

<body>

  <!-- SITE BANNER -->
<header class="site-banner" role="banner">
  <div class="banner-top">
    <!-- Left group: logo and text -->
    <div class="banner-left-group">
      <img
        src="{{ url_for('static', filename='images/deped_seal.png') }}"
        alt="DepEd Logo"
        class="banner-logo"
      />
      <div class="banner-left-text">
        <p class="sub-banner-dept">Schools Division of Laoag City</p>
        <p class="sub-banner-region">Region I – Ilocos Region</p>
      </div>
    </div>

    <!-- Centered title -->
    <div class="banner-text">
      <h1>DEPARTMENT OF EDUCATION</h1>
      <p class="banner-subtitle">Human Resource Merit Promotion and Selection Board</p>
    </div>
            <a href="{{ url_for('admin_logout') }}" class="banner-logout">Logout</a>
  </div>
</header>

  <!-- MAIN CONTAINER BOX -->
  <main class="form-container" role="main">

      <div class="tab-nav">
      <a href="#create_interview">Create Interview</a>
      <a href="#existing_interview">Existing Interview</a>
    </div>

    <div class="dashboard-box">
      <!-- Create Interview Panel -->
      <section class="card panel-create" aria-labelledby="create-heading" id="create_interview">
        <h2 id="create-heading">Create Interview</h2>
        <form method="post" action="{{ url_for('create_interview') }}">

          <label for="interview_type">Interview Type</label>
          <select id="interview_type" name="interview_type" required>
            <option disabled selected>– select –</option>
            <option value="non teaching">Non-Teaching</option>
            <option value="teacher 1">Teacher 1</option>
            <option value="school administration">School Administration</option>
            <option value="related teaching">Related Teaching</option>
            <option value="higher teaching">Higher Teaching</option>
          </select>

          <!-- Add this after the interview_type select in your form -->
          <div id="sg_level_container" style="display: none;">
            <label for="sg_level">Job Group/SG-Level</label>
            <select id="sg_level" name="sg_level" required>
              <option disabled selected>– select –</option>
            </select>
          </div>


          <label for="baseline_education">Baseline Education</label>
          <select id="baseline_education" name="baseline_education" required>
            <option disabled selected>– select –</option>
            {% for k, v in ed_labels.items() %}
            <option value="{{ k }}">{{ v }}</option>
            {% endfor %}
          </select>

          <label for="baseline_experience">Baseline Experience</label>
          <select id="baseline_experience" name="baseline_experience" required>
            <option disabled selected>– select –</option>
            {% for k, v in ex_labels.items() %}
            <option value="{{ k }}">{{ v }}</option>
            {% endfor %}
          </select>

          <label for="baseline_training">Baseline Training</label>
          <select id="baseline_training" name="baseline_training" required>
            <option disabled selected>– select –</option>
            {% for k, v in tr_labels.items() %}
            <option value="{{ k }}">{{ v }}</option>
            {% endfor %}
          </select>
          <div class="form-actions">
            <button type="submit" class="btn-submit">Create Interview</button>
          </div>
        </form>
      </section>

      <!-- Existing Interviews Panel -->
      <section class="card panel-list" aria-labelledby="list-heading" id="existing_interview">
        <h2 id="list-heading">Existing Interviews</h2>
        <table class="qual-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Date</th>
              <th>Baselines</th>
              <th>#Eval</th>
              <th>#Applicants</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            {% for iv in interviews %}
            <tr>
              <td>{{ iv.id }}</td>
              <td>{{ iv.date }} </td>
              <td>
                Education:  {{ ed_labels[iv.base_edu ~ ''] }} <br>
                Experience: {{ ex_labels[iv.base_exp ~ ''] }} <br>
                Training: {{ tr_labels[iv.base_trn ~ ''] }}
              </td>
              <td>{{ iv.evaluator_tokens|length }}</td>
              <td>{{ iv.applicants|length }}</td>
              <td>
                <a href="{{ url_for('admin_interview_detail', iid=iv.id) }}" class="btn-submit btn-submit--view">View</a>
                <a href="{{ url_for('update_interview', iid=iv.id) }}" class="btn-submit btn-submit--update">Update</a>
                <a href="{{ url_for('delete_interview', iid=iv.id) }}" class="btn-submit btn-submit--delete">Delete</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
    </div>

  </main>

  <!-- SITE FOOTER -->
  <footer class="admin-footer" role="contentinfo">
    <div class="footer-content">
      <div class="footer-logos">
        <img src="{{ url_for('static', filename='images/deped_logo.png') }}" alt="DepEd Logo" />
      </div>
      <div class="footer-links">
        <a href="mailto:laoag.city@deped.gov.ph"><i class="fas fa-envelope"></i>laoag.city@deped.gov.ph</a>
        <a href="https://www.facebook.com/depedtayolaoagcity" target="_blank"><i
            class="fab fa-facebook-square"></i>facebook.com/depedtayolaoagcity</a>
        <a href="https://www.depedlaoagcity.com" target="_blank"><i class="fas fa-globe"></i>depedlaoagcity.com</a>
      </div>
    </div>
  </footer>
  <script>
    // This will hold the loaded SG types data
    let sgTypesData = null;

    // Map interview types to JSON categories
    const interviewTypeMap = {
      'teacher 1': 'TEACHING_POSITIONS',
      'non teaching': 'NON_TEACHING',
      'higher teaching': 'SCHOOL_ADMIN',
      'school administration': 'SCHOOL_ADMIN',
      'related teaching': 'RELATED_TEACHING'
    };

    // Function to load the sg-type.json file
    async function loadSgTypes() {
      try {
        const response = await fetch("{{ url_for('static', filename='json/sg-type.json') }}");
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        sgTypesData = await response.json();
        console.log('SG Types loaded successfully:', sgTypesData);
      } catch (error) {
        console.error('Error loading SG types:', error);
        alert('Failed to load position data. Please check console for details.');
      }
    }

    // Function to update SG level dropdown based on selected interview type
    function updateSgLevels(interviewType) {
      const sgContainer = document.getElementById('sg_level_container');
      const sgSelect = document.getElementById('sg_level');

      // Clear existing options
      sgSelect.innerHTML = '<option disabled selected value="">– select –</option>';

      if (interviewType && sgTypesData) {
        const category = interviewTypeMap[interviewType];
        const positions = sgTypesData[category];

        if (positions && positions.length > 0) {
          sgContainer.style.display = 'block';

          // Add options for the selected interview type
          positions.forEach(position => {
            const optionText = `${position.Position_Title} (SG ${position.Salary_Grade})`;
            const optionValue = `${position.Position_Title};${position.Salary_Grade}`;
            const option = new Option(optionText, optionValue);
            sgSelect.appendChild(option);
          });
        } else {
          sgContainer.style.display = 'none';
          console.warn(`No positions found for category: ${category}`);
        }
      } else {
        sgContainer.style.display = 'none';
      }
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', async function () {
      // Load the SG types data first
      await loadSgTypes();

      // Get the interview type select element
      const interviewTypeSelect = document.getElementById('interview_type');

      // Set up the event listener for interview type changes
      interviewTypeSelect.addEventListener('change', function () {
        updateSgLevels(this.value);
      });

      // Trigger change event immediately if there's already a selected value
      if (interviewTypeSelect.value) {
        updateSgLevels(interviewTypeSelect.value);
      }
    });
  </script>
</body>

</html>