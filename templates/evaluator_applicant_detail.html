<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Applicant {{ applicant.code }} - Your Evaluation</title>
    <style>
      body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; }
      a.btn { padding: 0.4rem 0.8rem; background: #007bff; color: #fff; text-decoration: none; border-radius: 4px; }
      form { margin-top: 1rem; }
      fieldset { margin-bottom: 1rem; border: 1px solid #ccc; padding: 1rem; }
      legend { font-weight: bold; }
      label { display: block; margin: 0.5rem 0 0.2rem; }
      input, button { width: 100%; padding: 0.4rem; margin-top: 0.2rem; }
      button { background: #28a745; color: #fff; border: none; border-radius: 4px; }
    </style>
  </head>
  <body>
    <a href="{{ url_for('evaluator_dashboard') }}" class="btn">‚Üê Back to Dashboard</a>
    <h1>Applicant {{ applicant.code }} Evaluation</h1>
    <h2>{{ applicant.name }}</h2>
    
    <form method="post">
      {# If an evaluation exists with extra_data, parse it as JSON; otherwise use an empty dict #}
      {% if evaluation and evaluation.extra_data %}
        {% set existing_data = existing_data %}
      {% else %}
        {% set existing_data = {} %}
      {% endif %}
      
      {# Loop over each section in the evaluation structure #}
      {% for section, fields in eval_struct.items() %}
        <fieldset>
          <legend>{{ section|capitalize }}</legend>
          {% for field, max_val in fields.items() %}
            <label for="{{ field }}">{{ field|replace("_", " ")|capitalize }} (0-{{ max_val }})</label>
            <input type="number"
                   name="{{ field }}"
                   step="0.01"
                   min="0"
                   max="{{ max_val }}"
                   value="{% if existing_data.get(section) and existing_data[section].get(field) is not none %}{{ existing_data[section][field] }}{% endif %}"
                   required>
          {% endfor %}
        </fieldset>
      {% endfor %}
      
      <button type="submit">Save Evaluation</button>
    </form>
    
    {% if overall is not none %}
      <p>Your evaluation score: <strong>{{ overall }}</strong> (max 25)</p>
    {% endif %}
  </body>
</html>
