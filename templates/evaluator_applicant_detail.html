<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Applicant {{ applicant.code }} - Your Evaluation</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/evaluator_applicant_detail.css') }}" />
  <link rel="icon" type="image/png" href="{{url_for('static', filename='./images/deped_seal.png')}}" />
</head>

<body>

 <!-- SITE BANNER -->
<header class="site-banner" role="banner">
  <div class="banner-top">
    <!-- Left group: logo and text -->
    <div class="banner-left-group">
      <img
        src="{{ url_for('static', filename='images/deped_seal.png') }}"
        alt="DepEd Logo"
        class="banner-logo"
      />
      <div class="banner-left-text">
          <p class="sub-banner-dept">Schools Division of Laoag City</p>
        <p class="sub-banner-region">Region I – Ilocos Region</p>
      </div>
    </div>

    <!-- Centered title -->
    <div class="banner-text">
      <h1>DEPARTMENT OF EDUCATION</h1>
      <p class="banner-subtitle">Human Resource Merit Promotion and Selection Board</p>
    </div>
  </div>
</header>

{% with flashes = get_flashed_messages(
      with_categories=true,
      category_filter=["success", "error"]
   ) %}
  {% if flashes %}
    <div class="flash-msg-container">
      {% for category, text in flashes %}
        <div class="flash-{{ category }}">
          {{ text }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

  <div class="content-container">
    <form method="post">

      <div class="form-container">
      <a href="{{ url_for('evaluator_dashboard') }}" class="btn">← Dashboard</a>
</div>
      <h1>Applicant {{ applicant.code }} Evaluation</h1>
      <h2>{{ applicant.name }}</h2>
        <form method="post" id="evalForm" action="{{ url_for('evaluator_applicant_detail', code=applicant.code) }}">
          {% if evaluation and evaluation.extra_data %}
          {% set existing_data = existing_data %}
          {% else %}
          {% set existing_data = {} %}
          {% endif %}

          <div id="wizard">
            <!-- each fieldset becomes one “step” -->
            {% set ns = namespace(max_score=0) %}
            {% for section, fields in eval_struct.items() %}
            <fieldset class="step" data-step="{{ loop.index0 }}">
              {% set category = eval_struct[section].get('CATEGORY', {}) %}
              <legend>{{ section|capitalize }}</legend>
              {% for field, max_val in category.items() %}
              <label for="{{ section }}__{{ field }}">
                {{ field|replace("_", " ")|capitalize }} (0–{{ max_val }})
              </label>
                <input
                  id="{{ field }}"
                  name="{{ section }}_{{ field }}"
                  type="number"
                  step="0.01"
                  min="0"
                  max="{{ max_val }}"
                  required
                  value="{{ existing_data.get(section, {}).get(field, '') }}"
                >
                {% set ns.max_score = ns.max_score + max_val %}
              {% endfor %}
            </fieldset>
            {% endfor %}
          </div>

          <!-- navigation buttons -->
          <div class="wizard-nav">
            <button type="button" class="wizard-btn" id="prevBtn">← Back</button>
            <button type="button" class="wizard-btn primary" id="nextBtn">Next →</button>
            <button type="submit" class="wizard-btn primary" id="submitBtn">Save Evaluation</button>
          </div>
        </form>

        {% if overall is not none %}
        <p>Your evaluation score: <strong>{{ overall }}</strong> Max Score : <strong>{{ ns.max_score }}</strong></p>
        {% endif %}
  </div>

  <footer class="admin-footer">
    <div class="footer-content">
      <div class="footer-logos">
        <img src="{{ url_for('static', filename='images/deped_logo.png') }}" alt="DepEd Logo" />
      </div>
      <div class="footer-links">
        <a href="mailto:laoag.city@deped.gov.ph" title="Email">
          <i class="fas fa-envelope"></i> Email
        </a>
        <a href="https://www.facebook.com/depedtayolaoagcity" target="_blank" title="Facebook">
          <i class="fab fa-facebook-square"></i> Facebook
        </a>
        <a href="https://www.depedlaoagcity.com" target="_blank" title="Website">
          <i class="fas fa-globe"></i> Website
        </a>
      </div>
    </div>
  </footer>

  <script>
    (function () {
      const steps = document.querySelectorAll('.step');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const submit = document.getElementById('submitBtn');
      let idx = 0;

      function showStep(n) {
        steps.forEach((s, i) => s.classList.toggle('active', i === n));
        prevBtn.style.display = n > 0 ? '' : 'none';
        nextBtn.style.display = n < steps.length - 1 ? '' : 'none';
        submit.style.display = n === steps.length - 1 ? '' : 'none';
      }

      prevBtn.addEventListener('click', () => { idx = Math.max(0, idx - 1); showStep(idx); });
      nextBtn.addEventListener('click', () => { idx = Math.min(steps.length - 1, idx + 1); showStep(idx); });

    // initialize wizard
    showStep(idx);
  })();
</script>
</body>

</html>